<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="/layout/basic">

<div layout:fragment="content">
	<section class="breadcrumbs">
		<div class="container">
			<div class="d-flex justify-content-between align-items-center">
				<h2 style="display: inline" th:text="${Recipe_info.title}"></h2>
				<input type="hidden" id="recipeNo" th:value="${Recipe_info.recipeNo}" />
				<button class="btn btn-primary ajax2" th:onclick="addCart([[${ Recipe_info.cartDTO }]])">
					<img th:if="${Recipe_info.cartDTO == null}" src="/assets/img/star.svg" class="cart" />
					<img th:unless="${Recipe_info.cartDTO == null}" src="/assets/img/star-fill.svg" class="cart" />
				</button>
				<ol>
					<li style="display: inline; " th:text="조회수"></li>
					<li style="display: inline; " th:text="${Recipe_info.hit}"></li>
					<li style="display: inline" th:text="찜수"></li>
					<li style="display: inline" th:text="${Recipe_info.recommendedNumber}"></li>
				</ol>
				<ol>
					<!-- 이전단계 링크로 넣어줘야함 -->
					<li><a th:href="@{/}">Home</a></li> <!--  홈 링크 -->
					<li><a th:href="@{/recipe/list}">Recipe</a></li> <!--  레시피 리스트링크 -->
					<li>Recipe_detail</li>
				</ol>
			</div>
		</div>
	</section><!-- Breadcrumbs Section -->

	<!-- ======= Portfolio Details Section ======= -->
	<section id="portfolio-details" class="portfolio-details">
		<div class="container">
			<div class="row gy-4">
				<div class="col-lg-8">
					<div class="portfolio-details-slider swiper">
						<div class="swiper-wrapper align-items-center">
							<img th:src="|@{/assets/img/recipeimages/}${Recipe_info.imgFile}|" alt=""
								style="width:900px; height:600px;">
						</div>
						<section id="about" class="about section-bg" style="padding: 10px">
							<div class="container" data-aos="fade-up">
								<div class="row">
									<div class="col-lg-6 pt-4 pt-lg-0 content d-flex flex-column justify-content-center"
										data-aos="fade-up" data-aos-delay="100">
										<ul>
											<th:block th:if="${Recipe_info.storage != null}">
												<li>
													<i class="bx bx-store"></i>
													<div>
														<h5>음식 보관법 </h5>
														<p th:text="${Recipe_info.storage}"></p>
													</div>
												</li>
											</th:block>	
											<th:block th:each="recipe_step, status : ${AL_rs_split}">
												<li>
													<i class="bx bx-food-menu"></i>
													<div>
														<h5 th:text="${status.index + 1}"></h5>
														<p th:text="${recipe_step}"></p>
													</div>
												</li>
											</th:block>
											<th:block th:if="${Recipe_info.tip != null}">
												<li>
													<i class="bx bx-bulb"></i>
													<div>
														<h5>꿀팁</h5>
														<p th:text="${Recipe_info.tip}"></p>																										
													</div>
												</li>
											</th:block>
										</ul>
									</div>
								</div>
							</div>
						</section><!-- End About Section -->
					</div>
				</div>
				<div class="col-lg-4">
					<div class="portfolio-info">
						<div>
							<!--<img src="/assets/img/empty_star.jpg" alt="" style="width:27px; height:27px;"> -->

							<h3 style="display:inline-block;">&nbsp;구성 재료 &amp; 조리 영상 </h3>
						</div>
						<ul>
							<th:block th:each="split : ${AL_ri_split}">
								<li th:text="${split}"></li>
							</th:block>
						</ul>
					</div> <!-- portfolio-info -->

					<!-- 들어가야할곳 -->
					<!--  -->
				</div>
			</div>
		</div>
	</section><!-- End Portfolio Details Section -->
	<th:block layout:fragment="script">
        <script th:inline="javascript">
            /*<![CDATA[*/

            // var i = 0;
            // $('img').on('click', function () {
            //     if (i == 0) {
            //         $(this).attr('src', '/assets/img/star-fill.svg');
            //
            //         i++;
            //     } else if (i == 1) {
            //         $(this).attr('src', '/assets/img/star.svg');
            //         i--;
            //     }
            //
            // });
            var i = 0;
            function addCart(myRecipe) {
                if (myRecipe == null && i == 0) {

                    // json 형식으로 데이터 set

                    var params = {
                        recipeNo: $("#recipeNo").val(),

                    }

                    $.ajax({
                        url: "/cart/addRecipe",
                        type: "post",
                        data: params,
                        dataType: "json",
                        cache: false,
                        success: function (isExist) {
                            if (isExist == true) {
                                $('.cart').attr('src', '/assets/img/star-fill.svg');
                                alert("추가 성공")
                                i++;
                            }else {
                                alert("추가 실패");
                            }
                        },
                        error: function (XHR, status, error) {
                            console.error(status + " : " + error);
                        }
                    });
                } else if (myRecipe == null && i == 1) {
                    var params = {
                        recipeNo: $("#recipeNo").val(),
                    }

                    $.ajax({
                        url: "/cart/deleteRecipe",
                        type: "post",
                        data: params,
                        dataType: "json",
                        success: function (isExist) {
                            console.log(isExist);
                            if (isExist == true) {
                                $('.cart').attr('src', '/assets/img/star.svg');
                                alert("삭제 성공")
                                i--;
                            } else {
                                alert("삭제 실패");
                            }
                        },
                        error: function (XHR, status, error) {
                            console.error(status + " : " + error);
                        }
                    });
                } else if (myRecipe != null && i == 0) {
                    var params = {
                        recipeNo: $("#recipeNo").val(),
                    }

                    $.ajax({
                        url: "/cart/deleteRecipe",
                        type: "post",
                        data: params,
                        dataType: "json",
                        success: function (isExist) {
                            console.log(isExist);
                            if (isExist == true) {
                                $('.cart').attr('src', '/assets/img/star.svg');
                                alert("삭제 성공")
                                i++;
                            } else {
                                alert("삭제 실패");
                            }
                        },
                        error: function (XHR, status, error) {
                            console.error(status + " : " + error);
                        }
                    });
                } else {
                    var params = {
                        recipeNo: $("#recipeNo").val(),

                    }

                    $.ajax({
                        url: "/cart/addRecipe",
                        type: "post",
                        data: params,
                        dataType: "json",
                        cache: false,
                        success: function (isExist) {
                            if (isExist == true) {
                                $('.cart').attr('src', '/assets/img/star-fill.svg');
                                alert("추가 성공")
                                i--;
                            }else {
                                alert("추가 실패");
                            }
                        },
                        error: function (XHR, status, error) {
                            console.error(status + " : " + error);
                        }
                    });
                }
            }

            /*]]>*/
        </script>
    </th:block>
</div>

</html>